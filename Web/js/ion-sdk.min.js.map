{"version":3,"sources":["webpack://IonSDK/webpack/bootstrap","webpack://IonSDK/./src/stream.ts","webpack://IonSDK/./src/index.ts","webpack://IonSDK/./src/client.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","makeRemote","LocalStream","VideoConstraints","resolutions","qvga","resolution","width","ideal","height","frameRate","max","encodings","maxBitrate","maxFramerate","vga","shd","hd","fhd","qhd","defaults","codec","audio","video","simulcast","MediaStream","stream","constraints","super","this","navigator","mediaDevices","getUserMedia","computeAudioConstraints","computeVideoConstraints","getDisplayMedia","kind","tracks","getVideoTracks","length","undefined","getAudioTracks","getTracks","track","pc","idx","indexOf","rid","push","scaleResolutionDownBy","transceiver","addTransceiver","streams","direction","sendEncodings","setPreferredCodec","init","cap","RTCRtpSender","getCapabilities","selCodec","preferredCodecProfile","allCodecProfiles","codecs","filter","mimeType","toLowerCase","find","_a","sdpFmtpLine","setCodecPreferences","next","prev","addTrack","removeTrack","stop","getSenders","forEach","async","sender","_b","replaceTrack","publishTrack","ctx","window","AudioContext","webkitAudioContext","oscillator","createOscillator","frequency","setValueAtTime","currentTime","dst","connect","createMediaStreamDestination","start","canvas","assign","document","createElement","getContext","fillRect","captureStream","includes","deviceId","getTrack","getNewTrack","updateTrack","sendEmptyOnMute","emptyTrack","initAudioEmptyTrack","initVideoEmptyTrack","getSettings","enabled","encodingParams","senders","id","params","getParameters","setParameters","transport","remote","framerate","_videoPreMute","select","streamId","api","readyState","onopen","send","JSON","stringify","preferLayer","layer","preferFramerate","mute","unmute","Client","client_1","default","stream_1","Transport","ERR_NO_SESSION","Role","role","signal","config","RTCPeerConnection","candidates","pub","createDataChannel","onicecandidate","candidate","trickle","target","oniceconnectionstatechange","e","iceConnectionState","restartIce","iceServers","urls","onnegotiate","negotiate","ontrickle","sid","uid","transports","sub","ontrack","ev","ondatachannel","channel","label","onmessage","onspeaker","parse","data","offer","createOffer","setLocalDescription","answer","join","setRemoteDescription","addIceCandidate","onnegotiationneeded","onNegotiationNeeded","values","close","selector","Error","getStats","publish","remoteDescription","description","createAnswer","err","console","error","onerrnegotiate"],"mappings":"uBACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QA0Df,OArDAF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,+BCjFrDrB,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQkC,WAAalC,EAAQmC,YAAcnC,EAAQoC,sBAAmB,EACtE,MAAMC,EAAc,CAAC,OAAQ,MAAO,MAAO,KAAM,MAAO,OACxDrC,EAAQoC,iBAAmB,CACvBE,KAAM,CACFC,WAAY,CACRC,MAAO,CAAEC,MAAO,KAChBC,OAAQ,CAAED,MAAO,KACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,KACZC,aAAc,KAGtBC,IAAK,CACDT,WAAY,CACRC,MAAO,CAAEC,MAAO,KAChBC,OAAQ,CAAED,MAAO,KACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,IACZC,aAAc,KAGtBE,IAAK,CACDV,WAAY,CACRC,MAAO,CAAEC,MAAO,KAChBC,OAAQ,CAAED,MAAO,KACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,KACZC,aAAc,KAGtBG,GAAI,CACAX,WAAY,CACRC,MAAO,CAAEC,MAAO,MAChBC,OAAQ,CAAED,MAAO,KACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,KACZC,aAAc,KAGtBI,IAAK,CACDZ,WAAY,CACRC,MAAO,CAAEC,MAAO,MAChBC,OAAQ,CAAED,MAAO,MACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,IACZC,aAAc,KAGtBK,IAAK,CACDb,WAAY,CACRC,MAAO,CAAEC,MAAO,MAChBC,OAAQ,CAAED,MAAO,MACjBE,UAAW,CACPF,MAAO,GACPG,IAAK,KAGbC,UAAW,CACPC,WAAY,IACZC,aAAc,MAI1B,MAAMM,EAAW,CACbd,WAAY,KACZe,MAAO,MACPC,OAAO,EACPC,OAAO,EACPC,WAAW,GAEf,MAAMtB,UAAoBuB,YACtB,YAAYC,EAAQC,GAChBC,MAAMF,GACNG,KAAKF,YAAcA,EAEvB,0BAA0BA,EAAcP,GACpC,MAAMM,QAAeI,UAAUC,aAAaC,aAAa,CACrDV,MAAOpB,EAAY+B,wBAAwB,IACpCb,KACAO,IAEPJ,MAAOrB,EAAYgC,wBAAwB,IACpCd,KACAO,MAGX,OAAO,IAAIzB,EAAYwB,EAAQ,IACxBN,KACAO,IAGX,6BAA6BA,EAAc,CACvCN,MAAO,MACPf,WAAY,KACZgB,OAAO,EACPC,OAAO,EACPC,WAAW,IAGX,MAAME,QAAeI,UAAUC,aAAaI,gBAAgBR,GAC5D,OAAO,IAAIzB,EAAYwB,EAAQ,IACxBN,KACAO,IAGX,+BAA+BA,GAC3B,OAAOA,EAAYL,MAEvB,+BAA+BK,GAC3B,OAAIA,EAAYJ,iBAAiB5C,OACtBgD,EAAYJ,MAEdI,EAAYJ,OAASI,EAAYrB,WAC/B,IACAvC,EAAQoC,iBAAiBwB,EAAYrB,YAAYA,YAGrDqB,EAAYJ,MAEvB,SAASa,GACL,IAAIC,EACJ,MAAa,UAATD,GACAC,EAASR,KAAKS,iBACPD,EAAOE,OAAS,EAAIV,KAAKS,iBAAiB,QAAKE,IAE1DH,EAASR,KAAKY,iBACPJ,EAAOE,OAAS,EAAIV,KAAKY,iBAAiB,QAAKD,GAE1D,kBAAkBJ,GAMd,aALqBN,UAAUC,aAAaC,aAAa,CACrD,CAACI,GAAgB,UAATA,EACFlC,EAAYgC,wBAAwBL,KAAKF,aACzCzB,EAAY+B,wBAAwBJ,KAAKF,gBAErCe,YAAY,GAE9B,aAAaC,GACT,GAAId,KAAKe,GACL,GAAmB,UAAfD,EAAMP,MAAoBP,KAAKF,YAAYH,UAAW,CACtD,MAAMqB,EAAMzC,EAAY0C,QAAQjB,KAAKF,YAAYrB,YAC3CM,EAAY,CACd,CACImC,IAAK,IACLlC,WAAY9C,EAAQoC,iBAAiBC,EAAYyC,IAAMjC,UAAUC,WACjEC,aAAc/C,EAAQoC,iBAAiBC,EAAYyC,IAAMjC,UAAUE,eAGvE+B,EAAM,GAAK,GACXjC,EAAUoC,KAAK,CACXD,IAAK,IACLE,sBAAuB,EACvBpC,WAAY9C,EAAQoC,iBAAiBC,EAAYyC,EAAM,IAAIjC,UAAUC,WACrEC,aAAc/C,EAAQoC,iBAAiBC,EAAYyC,EAAM,IAAIjC,UAAUE,eAG3E+B,EAAM,GAAK,GACXjC,EAAUoC,KAAK,CACXD,IAAK,IACLE,sBAAuB,EACvBpC,WAAY9C,EAAQoC,iBAAiBC,EAAYyC,EAAM,IAAIjC,UAAUC,WACrEC,aAAc/C,EAAQoC,iBAAiBC,EAAYyC,EAAM,IAAIjC,UAAUE,eAG/E,MAAMoC,EAAcrB,KAAKe,GAAGO,eAAeR,EAAO,CAC9CS,QAAS,CAACvB,MACVwB,UAAW,WACXC,cAAe1C,IAEnBiB,KAAK0B,kBAAkBL,EAAaP,EAAMP,UAEzC,CACD,MAAMoB,EAAO,CACTJ,QAAS,CAACvB,MACVwB,UAAW,YAEI,UAAfV,EAAMP,OACNoB,EAAKF,cAAgB,CAACvF,EAAQoC,iBAAiB0B,KAAKF,YAAYrB,YAAYM,YAEhF,MAAMsC,EAAcrB,KAAKe,GAAGO,eAAeR,EAAOa,GAClD3B,KAAK0B,kBAAkBL,EAAaP,EAAMP,OAItD,kBAAkBc,EAAad,GAC3B,GAAI,wBAAyBc,EAAa,CACtC,MAAMO,EAAMC,aAAaC,gBAAgBvB,GACzC,IAAKqB,EACD,OACJ,IAAIG,EACJ,GAAI/B,KAAKF,YAAYkC,uBAAkC,UAATzB,EAAkB,CAC5D,MAAM0B,EAAmBL,EAAIM,OAAOC,OAAQ1F,GAAMA,EAAE2F,SAASC,gBAAkB,SAASrC,KAAKF,YAAYN,MAAM6C,eAC/G,IAAKJ,EACD,OAEJF,EAAWE,EAAiBK,KAAM7F,IAAQ,IAAI8F,EAAI,OAAO9F,EAAE+F,cAAyC,QAAxBD,EAAK9F,EAAE+F,mBAAgC,IAAPD,OAAgB,EAASA,EAAGtB,QAAQ,oBAAoBjB,KAAKF,YAAYkC,yBAA6B,IAC7MD,IAEDA,EAAWE,EAAiB,SAIhCF,EAAWH,EAAIM,OAAOI,KAAM7F,GAAMA,EAAE2F,SAASC,gBAAkB,SAASrC,KAAKF,YAAYN,MAAM6C,eAC9D,eAA7B5F,EAAE2F,SAASC,eAEfN,GACAV,EAAYoB,oBAAoB,CAACV,KAI7C,YAAYW,EAAMC,GACd3C,KAAK4C,SAASF,GAEVC,GACA3C,KAAK6C,YAAYF,GACjBA,EAAKG,OACD9C,KAAKe,IACLf,KAAKe,GAAGgC,aAAaC,QAAQC,MAAOC,IAChC,IAAIX,EAAIY,GACqE,QAAvEZ,EAAKW,aAAuC,EAASA,EAAOpC,aAA0B,IAAPyB,OAAgB,EAASA,EAAGhC,QAAUmC,EAAKnC,OACpG,QAAvB4C,EAAKD,EAAOpC,aAA0B,IAAPqC,GAAyBA,EAAGL,OAC5DI,EAAOE,aAAaV,QAMhC1C,KAAK4C,SAASF,GACV1C,KAAKe,IACLf,KAAKqD,aAAaX,IAI9B,sBAEI,MACMY,EAAM,IADSC,OAAOC,cAAgBD,OAAOE,oBAE7CC,EAAaJ,EAAIK,mBACvBD,EAAWE,UAAUC,eAAe,IAAOP,EAAIQ,aAC/C,MAAMC,EAAML,EAAWM,QAAQV,EAAIW,gCAEnC,OADAP,EAAWQ,QACJH,EAAIlE,OAAOe,iBAAiB,GAEvC,oBAAoBlC,EAAOE,GACvB,IAAI2D,EACJ,MAAM4B,EAASrH,OAAOsH,OAAOC,SAASC,cAAc,UAAW,CAAE5F,QAAOE,WACrC,QAAlC2D,EAAK4B,EAAOI,WAAW,aAA0B,IAAPhC,GAAyBA,EAAGiC,SAAS,EAAG,EAAG9F,EAAOE,GAE7F,OADeuF,EAAOM,gBACRhE,iBAAiB,GAEnC,QAAQM,GACJf,KAAKe,GAAKA,EACVf,KAAKa,YAAYmC,QAAQhD,KAAKqD,aAAazF,KAAKoC,OAEpD,YACI,GAAIA,KAAKe,GAAI,CACT,MAAMP,EAASR,KAAKa,YACpBb,KAAKe,GAAGgC,aAAaC,QAAS7E,IACtBA,EAAE2C,OAASN,EAAOkE,SAASvG,EAAE2C,QAC7Bd,KAAKe,GAAG8B,YAAY1E,MAKpC,mBAAmBoC,EAAMoE,GACrB3E,KAAKF,YAAc,IACZE,KAAKF,YACR,CAACS,GAAOP,KAAKF,YAAYS,aAAiBzD,OACpC,IACKkD,KAAKF,YAAYS,GACpBoE,YAEF,CAAEA,aAEZ,MAAMhC,EAAO3C,KAAK4E,SAASrE,GACrBmC,QAAa1C,KAAK6E,YAAYtE,GACpCP,KAAK8E,YAAYpC,EAAMC,GAE3B,KAAKpC,GACD,MAAMO,EAAQd,KAAK4E,SAASrE,GAC5B,GAAIO,GAASd,KAAKF,YAAYiF,gBAAiB,CAC3C,MAAMC,EAAsB,UAATzE,EACbP,KAAKiF,sBACLjF,KAAKkF,qBAAqBpE,aAAqC,EAASA,EAAMqE,cAAczG,QAAU,KAAMoC,aAAqC,EAASA,EAAMqE,cAAcvG,SAAW,KAG/L,OAFAoG,EAAWI,SAAU,OACrBpF,KAAK8E,YAAYE,EAAYlE,GAG7BA,GACAA,EAAMgC,OAGd,aAAavC,GACT,MAAMoC,EAAO3C,KAAK4E,SAASrE,GACrBO,QAAcd,KAAK6E,YAAYtE,GACrCP,KAAK8E,YAAYhE,EAAO6B,GAE5B,0BAA0B0C,GACjBrF,KAAKe,IAEVf,KAAKa,YAAYmC,QAASlC,IACtB,IAAIyB,EAAIY,EACR,MAAMmC,EAAyF,QAA9EnC,EAAwB,QAAlBZ,EAAKvC,KAAKe,UAAuB,IAAPwB,OAAgB,EAASA,EAAGQ,oBAAiC,IAAPI,OAAgB,EAASA,EAAGhB,OAAQe,IAAa,IAAIX,EAAI,OAAOzB,EAAMyE,MAAgC,QAAvBhD,EAAKW,EAAOpC,aAA0B,IAAPyB,OAAgB,EAASA,EAAGgD,MACjPD,SAAkDA,EAAQtC,QAASE,IAC/D,MAAMsC,EAAStC,EAAOuC,gBACjBD,EAAOzG,YACRyG,EAAOzG,UAAY,CAAC,KAExByG,EAAOzG,UAAU,GAAK,IACfyG,EAAOzG,UAAU,MACjBsG,GAEPnC,EAAOwC,cAAcF,QAKrCtJ,EAAQmC,YAAcA,EAqDtBnC,EAAQkC,WApDR,SAAoByB,EAAQ8F,GACxB,MAAMC,EAAS/F,EACf+F,EAAOnG,OAAQ,EACfmG,EAAOlG,MAAQ,OACfkG,EAAOC,UAAY,OACnBD,EAAOE,cAAgB,OACvB,MAAMC,EAAS,KACX,MAAMxJ,EAAO,CACTyJ,SAAUJ,EAAOL,GACjB7F,MAAOkG,EAAOlG,MACdD,MAAOmG,EAAOnG,MACdoG,UAAWD,EAAOC,WAElBF,EAAUM,MACuB,SAA7BN,EAAUM,IAAIC,WAEdP,EAAUM,IAAIE,OAAS,KAAQ,IAAI5D,EAAI,OAAgC,QAAxBA,EAAKoD,EAAUM,WAAwB,IAAP1D,OAAgB,EAASA,EAAG6D,KAAKC,KAAKC,UAAU/J,KAG/HoJ,EAAUM,IAAIG,KAAKC,KAAKC,UAAU/J,MA+B9C,OA3BAqJ,EAAOW,YAAeC,IAClBZ,EAAOlG,MAAQ8G,EACfT,KAEJH,EAAOa,gBAAmBD,IACtBZ,EAAOC,UAAYW,EACnBT,KAEJH,EAAOc,KAAQnG,IACE,UAATA,EACAqF,EAAOnG,OAAQ,EAED,UAATc,IACLqF,EAAOE,cAAgBF,EAAOlG,MAC9BkG,EAAOlG,MAAQ,QAEnBqG,KAEJH,EAAOe,OAAUpG,IACA,UAATA,EACAqF,EAAOnG,OAAQ,EAED,UAATc,IACLqF,EAAOlG,MAAQkG,EAAOE,eAE1BC,KAEGH,I,6BCzYX9I,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQmC,YAAcnC,EAAQ0K,YAAS,EACvC,MAAMC,EAAW,EAAQ,GACzB3K,EAAQ0K,OAASC,EAASC,QAC1B,MAAMC,EAAW,EAAQ,GACzBjK,OAAOC,eAAeb,EAAS,cAAe,CAAEc,YAAY,EAAMC,IAAK,WAAc,OAAO8J,EAAS1I,gB,6BCLrGvB,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQ8K,eAAY,EACpB,MAAMD,EAAW,EAAQ,GAEnBE,EAAiB,gCACvB,IAAIC,GACJ,SAAWA,GACPA,EAAKA,EAAU,IAAI,GAAK,MACxBA,EAAKA,EAAU,IAAI,GAAK,MAF5B,CAGGA,IAASA,EAAO,KACnB,MAAMF,EACF,YAAYG,EAAMC,EAAQC,GACtBrH,KAAKoH,OAASA,EACdpH,KAAKe,GAAK,IAAIuG,kBAAkBD,GAChCrH,KAAKuH,WAAa,GACdJ,IAASD,EAAKM,KACdxH,KAAKe,GAAG0G,kBAbA,WAeZzH,KAAKe,GAAG2G,eAAiB,EAAGC,gBACpBA,GACA3H,KAAKoH,OAAOQ,QAAQ,CAAEC,OAAQV,EAAMQ,eAG5C3H,KAAKe,GAAG+G,2BAA6B7E,MAAO8E,IACL,iBAA/B/H,KAAKe,GAAGiH,oBACJhI,KAAKe,GAAGkH,YAERjI,KAAKe,GAAGkH,eAM5B/L,EAAQ8K,UAAYA,EAuIpB9K,EAAQ4K,QAtIR,MACI,YAAYM,EAAQC,EAAS,CACzB7H,MAAO,MACP0I,WAAY,CACR,CACIC,KAAM,CAAC,+BAAgC,qCAI/CnI,KAAKoH,OAASA,EACdpH,KAAKqH,OAASA,EACdD,EAAOgB,YAAcpI,KAAKqI,UAAUzK,KAAKoC,MACzCoH,EAAOkB,UAAYtI,KAAK4H,QAAQhK,KAAKoC,MAEzC,WAAWuI,EAAKC,GACZxI,KAAKyI,WAAa,CACd,CAACvB,EAAKM,KAAM,IAAIR,EAAUE,EAAKM,IAAKxH,KAAKoH,OAAQpH,KAAKqH,QACtD,CAACH,EAAKwB,KAAM,IAAI1B,EAAUE,EAAKwB,IAAK1I,KAAKoH,OAAQpH,KAAKqH,SAE1DrH,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAG4H,QAAWC,IACpC,MAAM/I,EAAS+I,EAAGrH,QAAQ,GACpBqE,EAASmB,EAAS3I,WAAWyB,EAAQG,KAAKyI,WAAWvB,EAAKwB,MAC5D1I,KAAK2I,SACL3I,KAAK2I,QAAQC,EAAG9H,MAAO8E,IAG/B5F,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAG8H,cAAiBD,IAC1C,GA1DQ,YA0DJA,EAAGE,QAAQC,MAOX,OANA/I,KAAKyI,WAAWvB,EAAKwB,KAAKzC,IAAM2C,EAAGE,aACnCF,EAAGE,QAAQE,UAAajB,IAChB/H,KAAKiJ,WACLjJ,KAAKiJ,UAAU5C,KAAK6C,MAAMnB,EAAEoB,SAKpCnJ,KAAK6I,eACL7I,KAAK6I,cAAcD,IAG3B,MAAMQ,QAAcpJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAGsI,oBAC3CrJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAGuI,oBAAoBF,GACvD,MAAMG,QAAevJ,KAAKoH,OAAOoC,KAAKjB,EAAKC,EAAKY,SAC1CpJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAG0I,qBAAqBF,GACxDvJ,KAAKyI,WAAWvB,EAAKM,KAAKD,WAAWvE,QAASvG,GAAMuD,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAG2I,gBAAgBjN,IACjGuD,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAG4I,oBAAsB3J,KAAK4J,oBAAoBhM,KAAKoC,MAErF,QACQA,KAAKyI,aACL3L,OAAO+M,OAAO7J,KAAKyI,YAAYzF,QAAS1F,GAAMA,EAAEyD,GAAG+I,gBAC5C9J,KAAKyI,YAGpB,YAAYsB,GACR,IAAK/J,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhB,OAAOjH,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAGkJ,SAASF,GAEjD,YAAYA,GACR,IAAK/J,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhB,OAAOjH,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAGkJ,SAASF,GAEjD,QAAQlK,GACJ,IAAKG,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhBpH,EAAOqK,QAAQlK,KAAKyI,WAAWvB,EAAKM,KAAKzG,IAE7C,kBAAkBgI,GACd,IAAK/I,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhB,OAAOjH,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAG0G,kBAAkBsB,GAE1D,QACQ/I,KAAKyI,YACL3L,OAAO+M,OAAO7J,KAAKyI,YAAYzF,QAAS1F,GAAMA,EAAEyD,GAAG+I,SAEvD9J,KAAKoH,OAAO0C,QAEhB,SAAQ,UAAEnC,EAAS,OAAEE,IACjB,IAAK7H,KAAKyI,WACN,MAAMuB,MAAM/C,GAEZjH,KAAKyI,WAAWZ,GAAQ9G,GAAGoJ,kBAC3BnK,KAAKyI,WAAWZ,GAAQ9G,GAAG2I,gBAAgB/B,GAG3C3H,KAAKyI,WAAWZ,GAAQN,WAAWpG,KAAKwG,GAGhD,gBAAgByC,GACZ,IAAKpK,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhB,IAAIsC,EACJ,UACUvJ,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAG0I,qBAAqBW,GACxDpK,KAAKyI,WAAWvB,EAAKwB,KAAKnB,WAAWvE,QAASvG,GAAMuD,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAG2I,gBAAgBjN,IACjGuD,KAAKyI,WAAWvB,EAAKwB,KAAKnB,WAAa,GACvCgC,QAAevJ,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAGsJ,qBACtCrK,KAAKyI,WAAWvB,EAAKwB,KAAK3H,GAAGuI,oBAAoBC,GACvDvJ,KAAKoH,OAAOmC,OAAOA,GAEvB,MAAOe,GAEHC,QAAQC,MAAMF,GACVtK,KAAKyK,gBACLzK,KAAKyK,eAAevD,EAAKwB,IAAK4B,EAAKF,EAAab,IAG5D,4BACI,IAAKvJ,KAAKyI,WACN,MAAMuB,MAAM/C,GAEhB,IAAImC,EACAG,EACJ,IACIH,QAAcpJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAGsI,oBACrCrJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAGuI,oBAAoBF,GACvDG,QAAevJ,KAAKoH,OAAOgC,MAAMA,SAC3BpJ,KAAKyI,WAAWvB,EAAKM,KAAKzG,GAAG0I,qBAAqBF,GAE5D,MAAOe,GAEHC,QAAQC,MAAMF,GACVtK,KAAKyK,gBACLzK,KAAKyK,eAAevD,EAAKM,IAAK8C,EAAKlB,EAAOG","file":"ion-sdk.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.makeRemote = exports.LocalStream = exports.VideoConstraints = void 0;\nconst resolutions = ['qvga', 'vga', 'shd', 'hd', 'fhd', 'qhd'];\nexports.VideoConstraints = {\n    qvga: {\n        resolution: {\n            width: { ideal: 320 },\n            height: { ideal: 180 },\n            frameRate: {\n                ideal: 15,\n                max: 30,\n            },\n        },\n        encodings: {\n            maxBitrate: 150000,\n            maxFramerate: 15.0,\n        },\n    },\n    vga: {\n        resolution: {\n            width: { ideal: 640 },\n            height: { ideal: 360 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 500000,\n            maxFramerate: 30.0,\n        },\n    },\n    shd: {\n        resolution: {\n            width: { ideal: 960 },\n            height: { ideal: 540 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 1200000,\n            maxFramerate: 30.0,\n        },\n    },\n    hd: {\n        resolution: {\n            width: { ideal: 1280 },\n            height: { ideal: 720 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 2500000,\n            maxFramerate: 30.0,\n        },\n    },\n    fhd: {\n        resolution: {\n            width: { ideal: 1920 },\n            height: { ideal: 1080 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 4000000,\n            maxFramerate: 30.0,\n        },\n    },\n    qhd: {\n        resolution: {\n            width: { ideal: 2560 },\n            height: { ideal: 1440 },\n            frameRate: {\n                ideal: 30,\n                max: 60,\n            },\n        },\n        encodings: {\n            maxBitrate: 8000000,\n            maxFramerate: 30.0,\n        },\n    },\n};\nconst defaults = {\n    resolution: 'hd',\n    codec: 'vp8',\n    audio: true,\n    video: true,\n    simulcast: false,\n};\nclass LocalStream extends MediaStream {\n    constructor(stream, constraints) {\n        super(stream);\n        this.constraints = constraints;\n    }\n    static async getUserMedia(constraints = defaults) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n            audio: LocalStream.computeAudioConstraints({\n                ...defaults,\n                ...constraints,\n            }),\n            video: LocalStream.computeVideoConstraints({\n                ...defaults,\n                ...constraints,\n            }),\n        });\n        return new LocalStream(stream, {\n            ...defaults,\n            ...constraints,\n        });\n    }\n    static async getDisplayMedia(constraints = {\n        codec: 'vp8',\n        resolution: 'hd',\n        audio: false,\n        video: true,\n        simulcast: false,\n    }) {\n        // @ts-ignore\n        const stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n        return new LocalStream(stream, {\n            ...defaults,\n            ...constraints,\n        });\n    }\n    static computeAudioConstraints(constraints) {\n        return constraints.audio;\n    }\n    static computeVideoConstraints(constraints) {\n        if (constraints.video instanceof Object) {\n            return constraints.video;\n        }\n        else if (constraints.video && constraints.resolution) {\n            return {\n                ...exports.VideoConstraints[constraints.resolution].resolution,\n            };\n        }\n        return constraints.video;\n    }\n    getTrack(kind) {\n        let tracks;\n        if (kind === 'video') {\n            tracks = this.getVideoTracks();\n            return tracks.length > 0 ? this.getVideoTracks()[0] : undefined;\n        }\n        tracks = this.getAudioTracks();\n        return tracks.length > 0 ? this.getAudioTracks()[0] : undefined;\n    }\n    async getNewTrack(kind) {\n        const stream = await navigator.mediaDevices.getUserMedia({\n            [kind]: kind === 'video'\n                ? LocalStream.computeVideoConstraints(this.constraints)\n                : LocalStream.computeAudioConstraints(this.constraints),\n        });\n        return stream.getTracks()[0];\n    }\n    publishTrack(track) {\n        if (this.pc) {\n            if (track.kind === 'video' && this.constraints.simulcast) {\n                const idx = resolutions.indexOf(this.constraints.resolution);\n                const encodings = [\n                    {\n                        rid: 'f',\n                        maxBitrate: exports.VideoConstraints[resolutions[idx]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx]].encodings.maxFramerate,\n                    },\n                ];\n                if (idx - 1 >= 0) {\n                    encodings.push({\n                        rid: 'h',\n                        scaleResolutionDownBy: 2.0,\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 1]].encodings.maxFramerate,\n                    });\n                }\n                if (idx - 2 >= 0) {\n                    encodings.push({\n                        rid: 'q',\n                        scaleResolutionDownBy: 4.0,\n                        maxBitrate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxBitrate,\n                        maxFramerate: exports.VideoConstraints[resolutions[idx - 2]].encodings.maxFramerate,\n                    });\n                }\n                const transceiver = this.pc.addTransceiver(track, {\n                    streams: [this],\n                    direction: 'sendonly',\n                    sendEncodings: encodings,\n                });\n                this.setPreferredCodec(transceiver, track.kind);\n            }\n            else {\n                const init = {\n                    streams: [this],\n                    direction: 'sendonly',\n                };\n                if (track.kind === 'video') {\n                    init.sendEncodings = [exports.VideoConstraints[this.constraints.resolution].encodings];\n                }\n                const transceiver = this.pc.addTransceiver(track, init);\n                this.setPreferredCodec(transceiver, track.kind);\n            }\n        }\n    }\n    setPreferredCodec(transceiver, kind) {\n        if ('setCodecPreferences' in transceiver) {\n            const cap = RTCRtpSender.getCapabilities(kind);\n            if (!cap)\n                return;\n            let selCodec;\n            if (this.constraints.preferredCodecProfile && kind === 'video') {\n                const allCodecProfiles = cap.codecs.filter((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}`);\n                if (!allCodecProfiles) {\n                    return;\n                }\n                selCodec = allCodecProfiles.find((c) => { var _a; return c.sdpFmtpLine && ((_a = c.sdpFmtpLine) === null || _a === void 0 ? void 0 : _a.indexOf(`profile-level-id=${this.constraints.preferredCodecProfile}`)) >= 0; });\n                if (!selCodec) {\n                    // get first one\n                    selCodec = allCodecProfiles[0];\n                }\n            }\n            else {\n                selCodec = cap.codecs.find((c) => c.mimeType.toLowerCase() === `video/${this.constraints.codec.toLowerCase()}` ||\n                    c.mimeType.toLowerCase() === `audio/opus`);\n            }\n            if (selCodec) {\n                transceiver.setCodecPreferences([selCodec]);\n            }\n        }\n    }\n    updateTrack(next, prev) {\n        this.addTrack(next);\n        // If published, replace published track with track from new device\n        if (prev) {\n            this.removeTrack(prev);\n            prev.stop();\n            if (this.pc) {\n                this.pc.getSenders().forEach(async (sender) => {\n                    var _a, _b;\n                    if (((_a = sender === null || sender === void 0 ? void 0 : sender.track) === null || _a === void 0 ? void 0 : _a.kind) === next.kind) {\n                        (_b = sender.track) === null || _b === void 0 ? void 0 : _b.stop();\n                        sender.replaceTrack(next);\n                    }\n                });\n            }\n        }\n        else {\n            this.addTrack(next);\n            if (this.pc) {\n                this.publishTrack(next);\n            }\n        }\n    }\n    initAudioEmptyTrack() {\n        // @ts-ignore\n        const AudioContext = window.AudioContext || window.webkitAudioContext;\n        const ctx = new AudioContext();\n        const oscillator = ctx.createOscillator();\n        oscillator.frequency.setValueAtTime(20000, ctx.currentTime);\n        const dst = oscillator.connect(ctx.createMediaStreamDestination());\n        oscillator.start();\n        return dst.stream.getAudioTracks()[0];\n    }\n    initVideoEmptyTrack(width, height) {\n        var _a;\n        const canvas = Object.assign(document.createElement('canvas'), { width, height });\n        (_a = canvas.getContext('2d')) === null || _a === void 0 ? void 0 : _a.fillRect(0, 0, width, height);\n        const stream = canvas.captureStream();\n        return stream.getVideoTracks()[0];\n    }\n    publish(pc) {\n        this.pc = pc;\n        this.getTracks().forEach(this.publishTrack.bind(this));\n    }\n    unpublish() {\n        if (this.pc) {\n            const tracks = this.getTracks();\n            this.pc.getSenders().forEach((s) => {\n                if (s.track && tracks.includes(s.track)) {\n                    this.pc.removeTrack(s);\n                }\n            });\n        }\n    }\n    async switchDevice(kind, deviceId) {\n        this.constraints = {\n            ...this.constraints,\n            [kind]: this.constraints[kind] instanceof Object\n                ? {\n                    ...this.constraints[kind],\n                    deviceId,\n                }\n                : { deviceId },\n        };\n        const prev = this.getTrack(kind);\n        const next = await this.getNewTrack(kind);\n        this.updateTrack(next, prev);\n    }\n    mute(kind) {\n        const track = this.getTrack(kind);\n        if (track && this.constraints.sendEmptyOnMute) {\n            const emptyTrack = kind === 'audio'\n                ? this.initAudioEmptyTrack()\n                : this.initVideoEmptyTrack((track === null || track === void 0 ? void 0 : track.getSettings().width) || 640, (track === null || track === void 0 ? void 0 : track.getSettings().height) || 360);\n            emptyTrack.enabled = false;\n            this.updateTrack(emptyTrack, track);\n            return;\n        }\n        if (track) {\n            track.stop();\n        }\n    }\n    async unmute(kind) {\n        const prev = this.getTrack(kind);\n        const track = await this.getNewTrack(kind);\n        this.updateTrack(track, prev);\n    }\n    updateMediaEncodingParams(encodingParams) {\n        if (!this.pc)\n            return;\n        this.getTracks().forEach((track) => {\n            var _a, _b;\n            const senders = (_b = (_a = this.pc) === null || _a === void 0 ? void 0 : _a.getSenders()) === null || _b === void 0 ? void 0 : _b.filter((sender) => { var _a; return track.id === ((_a = sender.track) === null || _a === void 0 ? void 0 : _a.id); });\n            senders === null || senders === void 0 ? void 0 : senders.forEach((sender) => {\n                const params = sender.getParameters();\n                if (!params.encodings) {\n                    params.encodings = [{}];\n                }\n                params.encodings[0] = {\n                    ...params.encodings[0],\n                    ...encodingParams,\n                };\n                sender.setParameters(params);\n            });\n        });\n    }\n}\nexports.LocalStream = LocalStream;\nfunction makeRemote(stream, transport) {\n    const remote = stream;\n    remote.audio = true;\n    remote.video = 'none';\n    remote.framerate = 'high';\n    remote._videoPreMute = 'high';\n    const select = () => {\n        const call = {\n            streamId: remote.id,\n            video: remote.video,\n            audio: remote.audio,\n            framerate: remote.framerate,\n        };\n        if (transport.api) {\n            if (transport.api.readyState !== 'open') {\n                // queue call if we aren't open yet\n                transport.api.onopen = () => { var _a; return (_a = transport.api) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(call)); };\n            }\n            else {\n                transport.api.send(JSON.stringify(call));\n            }\n        }\n    };\n    remote.preferLayer = (layer) => {\n        remote.video = layer;\n        select();\n    };\n    remote.preferFramerate = (layer) => {\n        remote.framerate = layer;\n        select();\n    };\n    remote.mute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = false;\n        }\n        else if (kind === 'video') {\n            remote._videoPreMute = remote.video;\n            remote.video = 'none';\n        }\n        select();\n    };\n    remote.unmute = (kind) => {\n        if (kind === 'audio') {\n            remote.audio = true;\n        }\n        else if (kind === 'video') {\n            remote.video = remote._videoPreMute;\n        }\n        select();\n    };\n    return remote;\n}\nexports.makeRemote = makeRemote;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.LocalStream = exports.Client = void 0;\nconst client_1 = require(\"./client\");\nexports.Client = client_1.default;\nconst stream_1 = require(\"./stream\");\nObject.defineProperty(exports, \"LocalStream\", { enumerable: true, get: function () { return stream_1.LocalStream; } });\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Transport = void 0;\nconst stream_1 = require(\"./stream\");\nconst API_CHANNEL = 'ion-sfu';\nconst ERR_NO_SESSION = 'no active session, join first';\nvar Role;\n(function (Role) {\n    Role[Role[\"pub\"] = 0] = \"pub\";\n    Role[Role[\"sub\"] = 1] = \"sub\";\n})(Role || (Role = {}));\nclass Transport {\n    constructor(role, signal, config) {\n        this.signal = signal;\n        this.pc = new RTCPeerConnection(config);\n        this.candidates = [];\n        if (role === Role.pub) {\n            this.pc.createDataChannel(API_CHANNEL);\n        }\n        this.pc.onicecandidate = ({ candidate }) => {\n            if (candidate) {\n                this.signal.trickle({ target: role, candidate });\n            }\n        };\n        this.pc.oniceconnectionstatechange = async (e) => {\n            if (this.pc.iceConnectionState === 'disconnected') {\n                if (this.pc.restartIce) {\n                    // this will trigger onNegotiationNeeded\n                    this.pc.restartIce();\n                }\n            }\n        };\n    }\n}\nexports.Transport = Transport;\nclass Client {\n    constructor(signal, config = {\n        codec: 'vp8',\n        iceServers: [\n            {\n                urls: ['stun:stun.l.google.com:19302', 'stun:stun1.l.google.com:19302'],\n            },\n        ],\n    }) {\n        this.signal = signal;\n        this.config = config;\n        signal.onnegotiate = this.negotiate.bind(this);\n        signal.ontrickle = this.trickle.bind(this);\n    }\n    async join(sid, uid) {\n        this.transports = {\n            [Role.pub]: new Transport(Role.pub, this.signal, this.config),\n            [Role.sub]: new Transport(Role.sub, this.signal, this.config),\n        };\n        this.transports[Role.sub].pc.ontrack = (ev) => {\n            const stream = ev.streams[0];\n            const remote = stream_1.makeRemote(stream, this.transports[Role.sub]);\n            if (this.ontrack) {\n                this.ontrack(ev.track, remote);\n            }\n        };\n        this.transports[Role.sub].pc.ondatachannel = (ev) => {\n            if (ev.channel.label === API_CHANNEL) {\n                this.transports[Role.sub].api = ev.channel;\n                ev.channel.onmessage = (e) => {\n                    if (this.onspeaker) {\n                        this.onspeaker(JSON.parse(e.data));\n                    }\n                };\n                return;\n            }\n            if (this.ondatachannel) {\n                this.ondatachannel(ev);\n            }\n        };\n        const offer = await this.transports[Role.pub].pc.createOffer();\n        await this.transports[Role.pub].pc.setLocalDescription(offer);\n        const answer = await this.signal.join(sid, uid, offer);\n        await this.transports[Role.pub].pc.setRemoteDescription(answer);\n        this.transports[Role.pub].candidates.forEach((c) => this.transports[Role.pub].pc.addIceCandidate(c));\n        this.transports[Role.pub].pc.onnegotiationneeded = this.onNegotiationNeeded.bind(this);\n    }\n    leave() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n            delete this.transports;\n        }\n    }\n    getPubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.getStats(selector);\n    }\n    getSubStats(selector) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.sub].pc.getStats(selector);\n    }\n    publish(stream) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        stream.publish(this.transports[Role.pub].pc);\n    }\n    createDataChannel(label) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        return this.transports[Role.pub].pc.createDataChannel(label);\n    }\n    close() {\n        if (this.transports) {\n            Object.values(this.transports).forEach((t) => t.pc.close());\n        }\n        this.signal.close();\n    }\n    trickle({ candidate, target }) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        if (this.transports[target].pc.remoteDescription) {\n            this.transports[target].pc.addIceCandidate(candidate);\n        }\n        else {\n            this.transports[target].candidates.push(candidate);\n        }\n    }\n    async negotiate(description) {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        let answer;\n        try {\n            await this.transports[Role.sub].pc.setRemoteDescription(description);\n            this.transports[Role.sub].candidates.forEach((c) => this.transports[Role.sub].pc.addIceCandidate(c));\n            this.transports[Role.sub].candidates = [];\n            answer = await this.transports[Role.sub].pc.createAnswer();\n            await this.transports[Role.sub].pc.setLocalDescription(answer);\n            this.signal.answer(answer);\n        }\n        catch (err) {\n            /* tslint:disable-next-line:no-console */\n            console.error(err);\n            if (this.onerrnegotiate)\n                this.onerrnegotiate(Role.sub, err, description, answer);\n        }\n    }\n    async onNegotiationNeeded() {\n        if (!this.transports) {\n            throw Error(ERR_NO_SESSION);\n        }\n        let offer;\n        let answer;\n        try {\n            offer = await this.transports[Role.pub].pc.createOffer();\n            await this.transports[Role.pub].pc.setLocalDescription(offer);\n            answer = await this.signal.offer(offer);\n            await this.transports[Role.pub].pc.setRemoteDescription(answer);\n        }\n        catch (err) {\n            /* tslint:disable-next-line:no-console */\n            console.error(err);\n            if (this.onerrnegotiate)\n                this.onerrnegotiate(Role.pub, err, offer, answer);\n        }\n    }\n}\nexports.default = Client;\n"],"sourceRoot":""}